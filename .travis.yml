language: python
python:
    - "2.7"

env:
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/benchmarks/all
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/benchmarks/cenv
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/benchmarks/float_math
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/benchmarks/mbed
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/benchmarks/printf
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/dsp/cmsis/fir_f32
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/dsp/mbed/fir_f32
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/export/mcb1700
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/KL25Z/lptmr PLATFORMIO_CI_BOARDS_ARGS="--board frdm_kl25z"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/KL25Z/pit PLATFORMIO_CI_BOARDS_ARGS="--board frdm_kl25z"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/KL25Z/rtc PLATFORMIO_CI_BOARDS_ARGS="--board frdm_kl25z"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/blinky
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/can PLATFORMIO_CI_BOARDS_ARGS="--board b96b_f446ve --board lpc1549"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/can_interrupt PLATFORMIO_CI_BOARDS_ARGS="--board nucleo_f042k6 --board lpc4088"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/dir PLATFORMIO_CI_BOARDS_ARGS="--board lpc1768"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/dir_sd PLATFORMIO_CI_BOARDS_ARGS="--board lpc11u24"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/echo_flow_control PLATFORMIO_CI_BOARDS_ARGS="--board lpc1768 --board samd21_xpro"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/freopen PLATFORMIO_CI_BOARDS_ARGS="--board lpc1768"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/fs PLATFORMIO_CI_BOARDS_ARGS="--board lpc11u24"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/interruptin_2 PLATFORMIO_CI_BOARDS_ARGS="--board lpc1114fn28 --board samr21_xpro"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/modserial
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/pin_toggling PLATFORMIO_CI_BOARDS_ARGS="--board samr21_xpro"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/portout PLATFORMIO_CI_BOARDS_ARGS="--board lpc1768 --board saml21_xpro_b"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/reset PLATFORMIO_CI_BOARDS_ARGS="--board teensy31 --board frdm_kl05z"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/serial_interrupt
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/serial_interrupt_2 PLATFORMIO_CI_BOARDS_ARGS="--board lpc4088 --board samd21_xpro"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/sleep_timeout
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/spi PLATFORMIO_CI_BOARDS_ARGS="--board lpc1768 --board samd21_xpro"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/spi_slave PLATFORMIO_CI_BOARDS_ARGS="--board lpc1549 --board disco_f476vg"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/mbed/stdio_benchmark PLATFORMIO_CI_BOARDS_ARGS="--board lpc1768"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/net/echo/udp_link_layer PLATFORMIO_CI_BOARDS_ARGS="--board lpc1768"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/net/helloworld/broadcast_receive PLATFORMIO_CI_BOARDS_ARGS="--board lpc1768"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/net/helloworld/broadcast_send PLATFORMIO_CI_BOARDS_ARGS="--board ubloxc027"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/net/helloworld/multicast_receive PLATFORMIO_CI_BOARDS_ARGS="--board lpc1768"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/net/helloworld/multicast_send PLATFORMIO_CI_BOARDS_ARGS="--board ubloxc027"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/rtos/cmsis/basic PLATFORMIO_CI_BOARDS_ARGS="--board efm32pg_stk3200 --board frdm_kl05z"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/rtos/cmsis/isr PLATFORMIO_CI_BOARDS_ARGS="--board wallBotBLE --board nucleo_f031k6"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/rtos/cmsis/mail PLATFORMIO_CI_BOARDS_ARGS="--board redBearLabBLENano --board nucleo_f042k6"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/rtos/cmsis/mutex PLATFORMIO_CI_BOARDS_ARGS="--board lpc1549 --board hrm1017"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/rtos/cmsis/queue PLATFORMIO_CI_BOARDS_ARGS="--board efm32pg_stk3200 --board frdm_kl05z"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/rtos/cmsis/semaphore PLATFORMIO_CI_BOARDS_ARGS="--board redBearLabBLENano --board nucleo_f042k6"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/rtos/cmsis/signals PLATFORMIO_CI_BOARDS_ARGS="--board efm32pg_stk3200 --board frdm_kl05z"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/rtos/cmsis/timer PLATFORMIO_CI_BOARDS_ARGS="--board wallBotBLE --board nucleo_f031k6"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/usb/device/audio PLATFORMIO_CI_BOARDS_ARGS="--board nucleo_f401re --board frdm_kl25z --board efm32pg_stk3600 --board lpc4088"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/usb/device/basic PLATFORMIO_CI_BOARDS_ARGS="--board nucleo_f410rb --board frdm_kl25z --board efm32pg_stk3600 --board lpc11u35"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/usb/device/keyboard PLATFORMIO_CI_BOARDS_ARGS="--board disco_f407vg --board frdm_kl25z --board efm32pg_stk3700 --board lpc1768"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/usb/device/midi PLATFORMIO_CI_BOARDS_ARGS="--board nucleo_f401re --board frdm_kl25z --board efm32pg_stk3600 --board lpc4088"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/usb/device/mouse_keyboard PLATFORMIO_CI_BOARDS_ARGS="--board nucleo_f411re --board frdm_kl25z --board efm32pg_stk3600 --board lpc11u35"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/usb/device/raw_hid PLATFORMIO_CI_BOARDS_ARGS="--board nucleo_f446re --board frdm_kl25z --board efm32pg_stk3800 --board lpc1768"
    - PLATFORMIO_CI_SRC=/home/travis/.platformio/packages/framework-mbed/libraries/tests/usb/device/serial PLATFORMIO_CI_BOARDS_ARGS="--board nucleo_f401re --board frdm_kl25z --board efm32pg_stk3600 --board lpc11u35"

install:
    # Don't forget to switch to stable PlatformIO 3.0 (line below) when it will be released
    # - pip install -U platformio
    - pip install -U https://github.com/platformio/platformio/archive/develop.zip
    - pio platform install https://github.com/platformio/platform-ststm32.git#feature/new-mbed-builder-integration --with-package framework-mbed
    - pio platform install https://github.com/platformio/platform-atmelsam.git#feature/new-mbed-builder-integration
    - pio platform install https://github.com/platformio/platform-freescalekinetis.git#feature/new-mbed-builder-integration
    - pio platform install https://github.com/platformio/platform-nordicnrf51.git#feature/new-mbed-builder-integration
    - pio platform install https://github.com/platformio/platform-nxplpc.git#feature/new-mbed-builder-integration
    - pio platform install https://github.com/platformio/platform-siliconlabsefm32.git#feature/new-mbed-builder-integration
    - pio platform install https://github.com/platformio/platform-teensy.git#feature/new-mbed-builder-integration

script:
    - if [[ $PLATFORMIO_CI_BOARDS_ARGS ]]; then bash -c 'platformio ci $PLATFORMIO_CI_BOARDS_ARGS'; else platformio ci --board bbcmicrobit --board efm32pg_stk3401 --board nucleo_l152re --board frdm_kl46z --board samd21_xpro --board lpc11u35; fi
